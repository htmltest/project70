<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>ЖК «Времена года»</title>

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Open+Sans+Condensed:300,700|Roboto+Slab:300,400,700|Roboto:300,400,400i,700,700i&amp;subset=cyrillic">
        <link rel="stylesheet" href="css/styles.css" />
        <link rel="stylesheet" href="js/cocoen/cocoen.min.css" />
        <link rel="stylesheet" href="js/chosen/chosen.css" />
        <link rel="stylesheet" href="js/jscrollpane/jquery.jscrollpane.css" />
        <link rel="stylesheet" href="js/slick/slick.css" />
        <link rel="stylesheet" href="js/nouislider/nouislider.css">

        <script src="js/jquery-2.2.2.min.js"></script>
        <script src="js/jquery.validate.min.js"></script>
        <script src="js/jquery.maskedinput.min.js"></script>
        <script src="js/cocoen/cocoen.min.js"></script>
        <script src="js/chosen/chosen.jquery.min.js"></script>
        <script src="js/jquery.maphilight.min.js"></script>
        <script src="js/jscrollpane/jquery.mousewheel.js"></script>
        <script src="js/jscrollpane/jquery.jscrollpane.min.js"></script>
        <script src="js/modernizr-video.min.js"></script>
        <script src="js/slick/slick.min.js"></script>
        <script src="js/nouislider/nouislider.min.js"></script>
        <script src="js/nouislider/wNumb.js"></script>
        <script src="js/tools.js"></script>

        <meta name="viewport" content="width=1280" />
    </head>

    <body>

        <!-- wrapper -->
        <div class="wrapper">

            <!-- side -->
            <div class="side">

                <div class="side-container">
                    <div class="side-content">
                        <div class="logo"><a href="#"><img src="images/logo.png" alt="" width="145" height="103" /></a></div>
                        <div class="logo-mini"><a href="#"><img src="images/logo-mini.png" alt="" width="144" height="41" /></a></div>

                        <div class="side-phone">
                            <div class="side-phone-title">наш телефон</div>
                            <div class="side-phone-text">+7 (495) 135-33-65</div>
                        </div>
                        <div class="side-phone-mini">
                            <div class="side-phone-title">наш телефон</div>
                            <div class="side-phone-text">+7 (495) 135-33-65</div>
                        </div>

                        <nav>
                            <ul>
                                <li><a href="#"><span>О жилом комплексе «Времена года»</span></a></li>
                                <li><a href="#"><span>Расположение и&nbsp;инфраструктура</span></a></li>
                                <li><a href="#"><span>Выбор квартиры по&nbsp;параметрам</span></a></li>
                                <li><a href="#"><span>Акции и&nbsp;спецпредложения</span></a></li>
                                <li><a href="#"><span>Фотогалерея</span></a></li>
                                <li><a href="#"><span>О застройщике</span></a></li>
                                <li class="active"><a href="#"><span>Контакты</span></a></li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <a href="#" class="side-link"></a>

                <a href="#" class="callback-link"></a>

                <div class="callback">
                    <h3>Обратный звонок</h3>
                    <form action="windows/success.html" method="post" class="ajaxForm">
                        <div class="form-label">Телефон</div>
                        <div class="form-input"><input type="text" name="phone" value="" class="required maskPhone" placeholder="+7 ( ___ ) ___-__-__" /></div>

                        <div class="form-label">Имя <strong>/ опционально</strong></div>
                        <div class="form-input"><input type="text" name="name" value="" /></div>

                        <div class="form-submit"><input type="submit" value="Отправить" /></div>
                    </form>

                    <a href="#" class="callback-close"></a>
                </div>

            </div>
            <!-- side END -->

            <!-- infrastructure detail -->
            <div class="infrastructure-detail">
                <div id="map">
                </div>

                <script src="http://api-maps.yandex.ru/2.1/?load=package.full&lang=ru-RU" type="text/javascript"></script>
                <script type="text/javascript">
                    ymaps.ready(init);

                    var myMap;

                    var objectsMap =    [
                                            ['Ж/д станция "Одинцово" - 1 км',       1,  55.672335,  37.282525   ],
                                            ['Школа No3 - 120 м',                   3,  55.66541,   37.285143   ],
                                            ['Детский сад No23 - 75 м',             2,  55.66404,   37.287938   ],
                                            ['Кафе "Ретро" - 570 м',                9,  55.668185,  37.284098   ],
                                            ['Ясли-сад No77 - 630 м',               2,  55.668815,  37.282059   ],
                                            ['Кафе "Шашлычный двор" - 500м',        9,  55.668108,  37.284903   ],
                                            ['Кафе "У Дяди Гены" - 1,2 км',         9,  55.673842,  37.283854   ],
                                            ['Детский сад No13 - 250 м',            2,  55.664234,  37.288925   ],
                                            ['Детский сад No26 - 380 м',            2,  55.665917,  37.28947    ],
                                            ['Аптека "Семейная" - 560 м',           8,  55.667818,  37.282756   ],
                                            ['Почта - 450 м',                       7,  55.666533,  37.28207    ],
                                            ['Детская консультация - 610 м',        5,  55.667854,  37.290448   ],
                                            ['Аптека No1 - 33 0м',                  8,  55.666138,  37.285486   ],
                                            ['Дикси - 600 м',                       4,  55.666845,  37.292851   ],
                                            ['Одинцовский Пассаж - 1 км',           4,  55.671371,  37.277062   ],
                                            ['McDonald\'s - 1 км',                  9,  55.672149,  37.279491   ],
                                            ['Аптека "Старый лекарь" - 1 км',       8,  55.672305,  37.278807   ],
                                            ['Школа No1 - 640 м',                   3,  55.66888,   37.287046   ],
                                            ['Школа No2 - 530 м',                   3,  55.668205,  37.285946   ],
                                            ['Сбербанк - 650 м',                    6,  55.668251,  37.290496   ],
                                            ['ТЦ "Наташа" - 890 м',                 4,  55.671009,  37.282364   ],
                                            ['Советская пельменная - 940 м',        9,  55.671439,  37.283698   ],
                                            ['Пятерочка - 970 м',                   4,  55.671983,  37.284659   ],
                                            ['Клиника "Альтамед" - 830 м',          5,  55.669898,  37.291028   ],
                                            ['ТЦ "ВЗОИ" - 1 км',                    4,  55.672526,  37.285142   ],
                                            ['Сбербанк - 170 м',                    6,  55.6648,    37.282793   ],
                                            ['Лаборатория Инвитро - 200 м',         5,  55.664499,  37.2845     ],
                                            ['Городская поликлиника No3 - 70 м',    5,  55.663997,  37.284381   ],
                                            ['ТЦ "Времена года" - 860 м',                4,  55.670688,  37.281044   ],
                                            ['ТЦ "Одинцовское подворье" - 1 км',    4,  55.672684,  37.279998   ]
                                        ];

                    function init () {
                        myMap = new ymaps.Map('map', {
                            center: [56.136, 40.390],
                            zoom: 15,
                            controls: []
                        });

                        myMap.controls.add('zoomControl', {
                            position: {
                                right: 10,
                                top: 108,
                                left: 'auto'
                            }
                        });

                        // Создание макета балуна
                        var MyBalloonLayout = ymaps.templateLayoutFactory.createClass(
                            '<div class="popover">' +
                                '$[[options.contentLayout]]' +
                                '</div>', {
                                /**
                                 * Строит экземпляр макета на основе шаблона и добавляет его в родительский HTML-элемент.
                                 * @see http://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/layout.templateBased.Base.xml#build
                                 * @function
                                 * @name build
                                 */
                                build: function () {
                                    this.constructor.superclass.build.call(this);

                                    this._$element = $('.popover', this.getParentElement());

                                    this.applyElementOffset();
                                },

                                /**
                                 * Удаляет содержимое макета из DOM.
                                 * @see http://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/layout.templateBased.Base.xml#clear
                                 * @function
                                 * @name clear
                                 */
                                clear: function () {
                                    this.constructor.superclass.clear.call(this);
                                },

                                /**
                                 * Метод будет вызван системой шаблонов АПИ при изменении размеров вложенного макета.
                                 * @see http://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose
                                 * @function
                                 * @name onSublayoutSizeChange
                                 */
                                onSublayoutSizeChange: function () {
                                    MyBalloonLayout.superclass.onSublayoutSizeChange.apply(this, arguments);

                                    if(!this._isElement(this._$element)) {
                                        return;
                                    }

                                    this.applyElementOffset();

                                    this.events.fire('shapechange');
                                },

                                /**
                                 * Сдвигаем балун, чтобы "хвостик" указывал на точку привязки.
                                 * @see http://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose
                                 * @function
                                 * @name applyElementOffset
                                 */
                                applyElementOffset: function () {
                                    this._$element.css({
                                        left: -this._$element[0].offsetHeight / 2,
                                        top: -this._$element[0].offsetHeight / 2
                                    });
                                },

                                /**
                                 * Закрывает балун при клике на крестик, кидая событие "userclose" на макете.
                                 * @see http://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose
                                 * @function
                                 * @name onCloseClick
                                 */
                                onCloseClick: function (e) {
                                    e.preventDefault();

                                    this.events.fire('userclose');
                                },

                                /**
                                 * Проверяем наличие элемента (в ИЕ и Опере его еще может не быть).
                                 * @function
                                 * @private
                                 * @name _isElement
                                 * @param {jQuery} [element] Элемент.
                                 * @returns {Boolean} Флаг наличия.
                                 */
                                _isElement: function (element) {
                                    return element && element[0];
                                }
                            });

                        // Создание вложенного макета содержимого балуна.
                        var MyBalloonContentLayout = ymaps.templateLayoutFactory.createClass(
                            '<div class="popover-content popover-content-0$[properties.balloonType]"><img src="$[properties.balloonImg]" alt="" />$[properties.balloonContent]</div>'
                        );

                        var myGeocoder = ymaps.geocode('Московская область, г. Одинцово, ул. Маковского, д. 26');
                        myGeocoder.then(
                            function (res) {
                                var coords = res.geoObjects.get(0).geometry.getCoordinates();
                                myPlacemark = new ymaps.Placemark(coords, {}, {
                                    iconLayout: 'default#image',
                                    iconImageHref: 'images/map-icon.png',
                                    iconImageSize: [71, 73],
                                    iconImageOffset: [-29, -73]
                                });
                                myMap.geoObjects.add(myPlacemark);
                                myMap.setCenter(coords);
                                var position = myMap.getGlobalPixelCenter();
                                myMap.setGlobalPixelCenter([ position[0], position[1] - 220]);
                            },
                            function (err) {
                                alert('Ошибка');
                            }
                        );

                        for (var i = 0; i < objectsMap.length - 1; i++) {

                            var myPlacemark = new ymaps.Placemark([objectsMap[i][2], objectsMap[i][3]], {
                                    balloonImg: 'images/infrastructure-map-0' + objectsMap[i][1] + '.png',
                                    balloonType: objectsMap[i][1],
                                    balloonContent: objectsMap[i][0]
                                }, {
                                    balloonLayout: MyBalloonLayout,
                                    balloonContentLayout: MyBalloonContentLayout,
                                    balloonPanelMaxMapArea: 0,
                                    balloonShadow: false,
                                    iconLayout: 'default#image',
                                    iconImageHref: 'images/infrastructure-map-0' + objectsMap[i][1] + '.png',
                                    iconImageSize: [38, 38],
                                    iconImageOffset: [-19, -19],
                                    hideIconOnBalloonOpen: false
                                });
                            myPlacemark.options.set({
                                showHintOnHover: false
                            });

                            myPlacemark.events.add('mouseenter', function (e) {
                                var geoObject = e.get('target'),
                                    balloon = geoObject.balloon;

                                balloon.open();
                                balloon.events.add('mouseleave', function () {
                                    balloon.close();
                                });
                            });

                            myMap.geoObjects.add(myPlacemark);
                        }

                    }

                </script>

                <!-- infrastructure list -->
                <div class="infrastructure-list">
                    <div class="infrastructure-list-title">Инфраструктура района</div>
                    <div class="infrastructure-list-text">Наведите на точку на карте, чтобы узнать подробности</div>
                    <ul>
                        <li><img src="images/infrastructure-map-01.png" alt="" width="38" height="38" /><span>Ж/д станция «Анапа»</span></li>
                        <li><img src="images/infrastructure-map-02.png" alt="" width="38" height="38" /><span>Детский сад</span></li>
                        <li><img src="images/infrastructure-map-03.png" alt="" width="38" height="38" /><span>Школа</span></li>
                        <li><img src="images/infrastructure-map-04.png" alt="" width="38" height="38" /><span>Супермаркет</span></li>
                        <li><img src="images/infrastructure-map-05.png" alt="" width="38" height="38" /><span>Больница</span></li>
                        <li><img src="images/infrastructure-map-06.png" alt="" width="38" height="38" /><span>Банк</span></li>
                        <li><img src="images/infrastructure-map-07.png" alt="" width="38" height="38" /><span>Почта</span></li>
                        <li><img src="images/infrastructure-map-08.png" alt="" width="38" height="38" /><span>Аптека</span></li>
                        <li><img src="images/infrastructure-map-09.png" alt="" width="38" height="38" /><span>Кафе</span></li>
                    </ul>
                </div>
                <!-- infrastructure list END -->

            </div>
            <!-- infrastructure detail END -->

        </div>
        <!-- wrapper END -->

    </body>
</html>